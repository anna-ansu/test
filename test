https://habr.com/ru/post/351982/ Matthias Noback Об Идеальной Архитектуре — Слои, Порты и Адаптеры(Часть 2 — Слои)
https://m.habr.com/ru/post/352700/ Matthias Noback Об Идеальной Архитектуре — Слои, Порты и Адаптеры (Часть 3 — Порты и Адаптеры)
https://github.com/ferrius/ddd-cqrs-example/ This is an example of implementation and my vision of practical CQRS, DDD, ADR, hexagonal architecture and directory structure.
https://github.com/ferrius/ddd-cqrs-example/blob/master/depfile.yaml Deptrac depfile.yaml example
https://github.com/YaFou/symfony-clean-architecture-skeleton/ Symfony Clean Architecture Skeleton

include:
    -   component: ....docker-up-down


stages:
    - deploy

variables:
    APP_ENV: prod
    APP_DEBUG: 0
    DOCKER_IMAGE: "registry....nameProject:$CI_COMMIT_BRANCH"
    

workflow:
    rules:
        -   if: $CI_COMMIT_REF_NAME == "main"
            variables:
                APP_ENV: prod
                SERVER_NAME: nameProject.nameServer
                TAG: tag

up:
    environment:
        name: "$TAG"
    script:
        - docker compose pull
        - docker compose up ${SERVICES_NAME} -d
down:
    environment:
        name: "$TAG"



FROM .. php:8-4
COPY . /app/

# RUN mv "$PHP_INI_DIR/php.ini-production" "$PHP_INI_DIR/php.ini" && \
RUN mv "/app/build/docker-entrypoint.sh" "/usr/local/bin/docker-entrypoint" && \
    chmod 755 /usr/local/bin/docker-entrypoint && \
    rm -Rf build/ && \
    set -eux && \
	mkdir -p var/cache var/log files && \
	chmod +x bin/console; sync && \
    php bin/console cache:clear --env=prod


CMD ["php", "-S", "localhost:80", "-t", "public"]


docker-entrypoint.sh - 

set -e

if [ "$1" = 'php' ] || [ "$1" = 'bin/console' ]; then
    if [ "$( find ./migrations -iname '*.php' -print -quit )" ]; then
        php bin/console doctrine:migrations:migrate --no-interaction
    fi
fi

exec docker-php-entrypoint "$@"



SECURITY WARNING: You are building a Docker image from Windows against a non-Windows Docker host. All files and directories added to build context will have
'-rwxr-xr-x' permissions. It is recommended to double check and reset permissions for sensitive files and directories.
Recreating symfony-test-php ... done
Exception ignored in: <function Popen.__del__ at 0x0000024469D194C0>
Traceback (most recent call last):
  File "subprocess.py", line 1051, in __del__
  File "subprocess.py", line 1453, in _internal_poll
OSError: [WinError 6] Неверный дескриптор
