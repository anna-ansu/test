include:
  - component: путь/test-phpunit
  - component: путь/build-node11
  - component: путь/build-php


stages:
  - test
  - build
  - deploy

phpunit:
  stage: test
  #script: echo 'Тест'
  variables:
      ORACLE_RANDOM_PASSWORD: yes
  services: 
    - name: путь/oracle-xe:18
      alias: db,oracle
      entrypoint: [""]
      command: ["/bin/sh","-c","sleep 5 && cp /builds/$CI_PROJECT_PATH/tests/_data/init-oracle-full.sql /container-entrypoint-initdb.d/ && container-entrypoint.sh"]
  script:
      - composer validate --strict
      - composer install --no-scripts --prefer-dist --no-ansi --no-interaction --no-progress -n --optimize-autoloader
      - sleep 15
      - php vendor/bin/phpunit 
  timeout: 5 minutes

build-js:
  image: путь/node:18


build-php:
  stage: build
  image: путь/php:8-4
  script: echo "Build"

deploy:
  stage: deploy
  script: echo "deploy"


- php vendor/bin/phpunit --colors=never --testsuite "Unit" --no-interaction --log-junit report.xml -d display_errors=on -d date.timezone="Etc/GMT-3"
